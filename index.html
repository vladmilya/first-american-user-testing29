<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISS Iterative Testing 4.1</title>
    <link rel="stylesheet" href="styles.css?v=1706857400">
    <link rel="stylesheet" href="note-taker-clean.css?v=20260201n">
    <style>
        /* FINAL FIX: Proper flexbox layout for controls bar */
        body.note-taker-active .note-taker-controls-bar {
            display: grid !important;
            grid-template-columns: auto 1fr auto !important;
            align-items: center !important;
            gap: 2rem !important;
            background: #f9fafb !important;
            border-bottom: 1px solid #e5e7eb !important;
            padding: 1rem 2rem !important;
            width: 100% !important;
            min-height: 70px !important;
            box-sizing: border-box !important;
            position: relative !important;
            z-index: 100 !important;
        }
        
        body.note-taker-active .controls-left {
            display: flex !important;
            flex-direction: row !important;
            align-items: center !important;
            gap: 1rem !important;
            justify-self: start !important;
        }
        
        body.note-taker-active .controls-center {
            display: flex !important;
            flex-direction: row !important;
            align-items: center !important;
            gap: 1rem !important;
            justify-self: center !important;
        }
        
        body.note-taker-active .controls-right {
            display: flex !important;
            flex-direction: row !important;
            align-items: center !important;
            gap: 0.75rem !important;
            justify-self: end !important;
        }
        
        body.note-taker-active .board-actions,
        body.note-taker-active .user-navigation,
        body.note-taker-active .topic-filter {
            display: flex !important;
            flex-direction: row !important;
            align-items: center !important;
            gap: 0.5rem !important;
        }
        
        body.note-taker-active .setup-users-btn,
        body.note-taker-active .add-note-thumb,
        body.note-taker-active .add-to-report-btn,
        body.note-taker-active .manage-topics-btn,
        body.note-taker-active .reset-topics-btn,
        body.note-taker-active .clear-selection-btn {
            display: inline-flex !important;
            flex-direction: row !important;
            align-items: center !important;
            gap: 0.375rem !important;
        }
    </style>
    <!-- Password protection DISABLED - uncomment to re-enable -->
    <!-- <script src="password-protection.js"></script> -->
</head>
<body>
    <div class="container">
        <header class="report-header" id="main-header">
            <div>
                <h1>ISS Iterative Testing 4.1</h1>
                <div class="report-meta">
                    <span id="date"></span>
                    <span id="participant-count"></span>
                </div>
            </div>
            <a href="#select-study" class="nav-link uxd-admin-btn">
                Select Study
            </a>
            <a href="#uxd-admin" class="nav-link uxd-admin-btn">
                UXD Admin
            </a>
        </header>
        
        <!-- Note Taker Header (shown when in note taker mode) -->
        <header class="report-header note-taker-header" id="note-taker-header" style="display: none;">
            <div class="note-taker-header-content">
                <h1>Note Taker</h1>
                <span class="campaign-badge" id="note-taker-campaign-header">
                    <span class="campaign-badge-label">Study:</span>
                    <span class="campaign-badge-name" id="note-taker-campaign-name-header">Loading...</span>
                </span>
            </div>
            <div class="note-taker-header-nav">
                <a href="#themes" class="note-taker-back-btn" onclick="goToBehavioralPatternsImportantNotes()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    Behavioral Patterns Syntheses
                </a>
                <a href="#" class="note-taker-back-btn" onclick="exitNoteTaker('uxd-admin'); return false;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M12 1v6M12 17v6M4.22 4.22l4.24 4.24M15.54 15.54l4.24 4.24M1 12h6M17 12h6M4.22 19.78l4.24-4.24M15.54 8.46l4.24-4.24"></path>
                    </svg>
                    Admin
                </a>
            </div>
        </header>

        <nav class="sidebar">
            <h3>Navigation</h3>
            <ul class="nav-menu">
                <li><a href="#executive-summary" class="nav-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
                    Study Summary
                </a></li>
                <li><a href="#research-questions" class="nav-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"></path><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
                    Study Evaluation
                </a></li>
                <li><a href="#key-findings" class="nav-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="M21 21l-4.35-4.35"></path><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>
                    Key Findings
                </a></li>
                <li><a href="#themes" class="nav-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
                    Behavioral Patterns
                </a></li>
                <li><a href="#pain-points" class="nav-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                    Pain Points
                </a></li>
                <li><a href="#quotes" class="nav-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                    Notable Quotes
                </a></li>
                <li><a href="#recommendations" class="nav-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                    Recommendations
                </a></li>
                <li><a href="#presentation" class="nav-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
                    Presentation
                </a></li>
                <li><a href="#note-taker" class="nav-link" onclick="enterNoteTaker()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                    Note Taker
                </a></li>
            </ul>
            
            <div class="search-box">
                <input type="text" id="search" placeholder="Search insights...">
            </div>
        </nav>

        <main class="content">
            <section id="executive-summary" class="section">
                <h2>Study Summary</h2>
                <div class="summary-content">
                    <p class="placeholder">Upload your transcript data to generate insights...</p>
                </div>
            </section>

            <section id="key-findings" class="section">
                <h2>Key Findings</h2>
                <div class="findings-grid">
                    <div class="placeholder">Findings will appear here after analysis...</div>
                </div>
            </section>

            <section id="themes" class="section">
                <h2>Behavioral Patterns</h2>
                <div class="themes-container">
                    <div class="placeholder">Themes will be identified from your data...</div>
                </div>
            </section>

            <section id="pain-points" class="section">
                <h2>User Pain Points</h2>
                <div class="pain-points-list">
                    <div class="placeholder">Pain points will be extracted...</div>
                </div>
            </section>

            <section id="quotes" class="section">
                <h2>Notable Quotes</h2>
                <div class="quotes-container">
                    <div class="placeholder">Key quotes will be highlighted...</div>
                </div>
            </section>

            <section id="recommendations" class="section">
                <h2>Recommendations</h2>
                <div class="recommendations-list">
                    <div class="placeholder">Actionable recommendations will be generated...</div>
                </div>
            </section>

            <section id="research-questions" class="section">
                <h2>Study Evaluation Details</h2>
                <p style="color: var(--text-light); margin-bottom: 2rem; font-size: 1.125rem;">
                    All detailed questions from the ISS P4.1 Iterative Testing Study Evaluation, organized by feature area, 
                    with synthesized findings from patterns observed across all 6 participants.
                </p>
                <div class="research-questions-list">
                    <div class="placeholder">Loading complete discussion guide with all questions and synthesized answers...</div>
                </div>
            </section>

            <section id="presentation" class="section">
                <div class="presentation-container">
                    <div class="presentation-header">
                        <h2>Presentation Mode</h2>
                        <div class="presentation-controls">
                            <button id="download-pdf" class="download-button">üì• Download PDF</button>
                            <button id="fullscreen-btn" class="download-button">‚õ∂ Fullscreen</button>
                        </div>
                    </div>
                    
                    <!-- AI & Presentation Builder Info Banner -->
                    <div id="ai-presentation-banner" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; color: white; transition: all 0.3s ease;">
                        <h3 style="color: white; margin-bottom: 1rem; font-size: 1.125rem; display: flex; align-items: center; gap: 0.5rem;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="5"></circle>
                                <path d="M12 1v6m0 6v6m5.2-13.2l-4.3 4.3m-1.8 1.8l-4.3 4.3M23 12h-6m-6 0H1m18.2 5.2l-4.3-4.3m-1.8-1.8l-4.3-4.3"></path>
                            </svg>
                            AI-Powered Presentation Builder
                        </h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1rem;">
                            <div>
                                <h4 style="color: white; font-size: 0.95rem; margin-bottom: 0.5rem;">ü§ñ AI Chat Assistant</h4>
                                <p style="font-size: 0.875rem; opacity: 0.95; line-height: 1.6;">Ask questions in natural language and let AI build presentations for you. Click the purple button in bottom-right corner to get started.</p>
                            </div>
                            <div>
                                <h4 style="color: white; font-size: 0.95rem; margin-bottom: 0.5rem;">üìä Manual Builder</h4>
                                <p style="font-size: 0.875rem; opacity: 0.95; line-height: 1.6;">Click "Open Builder" button below and select sections to add to your presentation from the dropdown menu.</p>
                            </div>
                        </div>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button onclick="aiAssistant && aiAssistant.toggleChat()" style="padding: 0.75rem 1.25rem; background: white; color: #667eea; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                Try AI Assistant
                            </button>
                            <button onclick="presentationBuilder && presentationBuilder.openBuilder()" style="padding: 0.75rem 1.25rem; background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid white; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                </svg>
                                Open Builder
                            </button>
                        </div>
                    </div>
                    
                    <div class="slideshow-container" id="slideshow">
                        <!-- Slides will be generated here -->
                    </div>
                    
                    <div class="slide-navigation">
                        <button class="nav-button" id="prev-slide">‚Äπ Previous</button>
                        <span class="slide-counter" id="slide-counter">1 / 1</span>
                        <button class="nav-button" id="next-slide">Next ‚Ä∫</button>
                    </div>
                </div>
            </section>

            <section id="note-taker" class="section">
                <div class="note-taker-container">
                    <!-- Board Controls -->
                    <div class="note-taker-controls-bar">
                        <div class="controls-left">
                            <div class="user-navigation">
                                <label class="user-nav-label">Interview:</label>
                                <select id="board-select" class="user-nav-select" onchange="switchBoard(this.value)"></select>
                                <button class="rename-interview-btn" onclick="showRenameInterviewModal()" title="Rename Interview">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="board-actions">
                                <button class="setup-users-btn" onclick="showUserSetupModal()" title="Set Number of Users">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="9" cy="7" r="4"></circle>
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                    </svg>
                                    Setup
                                </button>
                                <button class="setup-users-btn" onclick="if(window.collaborationManager && window.collaborationManager.isEnabled) { window.collaborationManager.showShareDialog(); } else { alert('Collaboration not enabled. Check supabase-config.js'); }" title="Share with Team" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="18" cy="5" r="3"></circle>
                                        <circle cx="6" cy="12" r="3"></circle>
                                        <circle cx="18" cy="19" r="3"></circle>
                                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                                    </svg>
                                    Share
                                </button>
                                <button class="add-note-thumb" onclick="addStickyNote()" title="Add Sticky Note">
                                    <span class="plus-icon">+</span>
                                </button>
                            </div>
                        </div>
                        <div class="controls-center">
                            <div class="topic-filter">
                                <label class="topic-filter-label">Filter by Evaluation Topic:</label>
                                <select id="topic-filter-select" class="topic-filter-select" onchange="filterByTopic(this.value)">
                                    <option value="all">All Topics</option>
                                </select>
                                <button class="manage-topics-btn" onclick="showManageTopicsModal()" title="Manage Topics">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="3"></circle>
                                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                                    </svg>
                                </button>
                                <button class="reset-topics-btn" onclick="resetTopicsToDefault()" title="Reset Topics">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="1 4 1 10 7 10"></polyline>
                                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="controls-right">
                            <button class="clear-selection-btn" onclick="deselectAllNotes()" style="display: none;">Clear Selection</button>
                            <button class="add-to-report-btn" onclick="addSelectedToReport()">+ Add Notes To Study</button>
                        </div>
                    </div>
                    
                    <!-- The Board -->
                    <div class="sticky-board-wrapper" id="board-wrapper">
                        <div id="sticky-board" class="sticky-board"></div>
                    </div>
                    
                    <!-- Zoom Controls - Bottom -->
                    <div class="zoom-controls-bottom">
                        <button class="zoom-btn" onclick="zoomBoard(-0.1)" title="Zoom Out">‚àí</button>
                        <span id="zoom-level">100%</span>
                        <button class="zoom-btn" onclick="zoomBoard(0.1)" title="Zoom In">+</button>
                        <button class="zoom-btn" onclick="resetZoom()" title="Reset Zoom">‚Ü∫</button>
                    </div>
                </div>
                
                <!-- User Setup Modal -->
                <div id="user-setup-modal" class="modal" style="display: none;">
                    <div class="user-setup-modal-content">
                        <h3>üë• Set Up User Boards</h3>
                        <p style="color: var(--text-light); margin-bottom: 1.5rem;">
                            Specify the number of users in this campaign. A separate note board will be created for each user.
                        </p>
                        
                        <div class="user-count-input-section">
                            <label for="user-count-input">Number of Users:</label>
                            <div class="user-count-controls">
                                <button class="count-btn" onclick="adjustUserCount(-1)">‚àí</button>
                                <input type="number" id="user-count-input" value="6" min="1" max="50">
                                <button class="count-btn" onclick="adjustUserCount(1)">+</button>
                            </div>
                        </div>
                        
                        <div class="user-preview" id="user-preview">
                            <!-- Preview will be populated here -->
                        </div>
                        
                        <div class="modal-actions">
                            <button class="modal-cancel-btn" onclick="closeUserSetupModal()">Cancel</button>
                            <button class="modal-confirm-btn" onclick="createUserBoards()">Create Boards</button>
                        </div>
                    </div>
                </div>
                
                <!-- Rename Interview Modal -->
                <div id="rename-interview-modal" class="modal" style="display: none;">
                    <div class="user-setup-modal-content">
                        <h3>‚úèÔ∏è Rename Interview</h3>
                        <p style="color: var(--text-light); margin-bottom: 1.5rem;">
                            Give this interview a custom name (e.g., participant name).
                        </p>
                        
                        <div class="user-count-input-section">
                            <label for="interview-name-input">Interview Name:</label>
                            <input type="text" id="interview-name-input" placeholder="Enter interview name" style="width: 100%; padding: 0.75rem; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem;">
                        </div>
                        
                        <div class="modal-actions">
                            <button class="modal-cancel-btn" onclick="closeRenameInterviewModal()">Cancel</button>
                            <button class="modal-confirm-btn" onclick="confirmRenameInterview()">Rename</button>
                        </div>
                    </div>
                </div>
                
                <!-- Manage Topics Modal -->
                <div id="manage-topics-modal" class="modal" style="display: none;">
                    <div class="manage-topics-modal-content">
                        <h3>üè∑Ô∏è Study Evaluation Topics</h3>
                        <p style="color: var(--text-light); margin-bottom: 1rem;">
                            Topics from your Study Evaluation file. Use the Reset button to restore default topics.
                        </p>
                        
                        <div class="topics-list-section">
                            <h4>Study Evaluation Topics</h4>
                            <div id="custom-topics-list" class="custom-topics-list">
                                <!-- Topics will be listed here -->
                            </div>
                        </div>
                        
                        <div class="add-topic-section">
                            <h4>Add New Topic</h4>
                            <div class="add-topic-input-group">
                                <input type="text" id="new-topic-input" placeholder="Enter topic name..." maxlength="50" onkeypress="if(event.key === 'Enter') addNewCustomTopic()">
                                <button class="add-topic-btn" onclick="addNewCustomTopic()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="5" x2="12" y2="19"></line>
                                        <line x1="5" y1="12" x2="19" y2="12"></line>
                                    </svg>
                                    Add Topic
                                </button>
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <button class="modal-confirm-btn" onclick="closeManageTopicsModal()">Done</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="transcripts" class="section">
                <h2>Build Study Report</h2>
                <p style="color: var(--text-light); margin-bottom: 2rem; font-size: 1.125rem;">
                    Upload all your research data in one place. The system will process everything together to generate comprehensive insights.
                </p>
                
                <!-- Interview Transcripts -->
                <div class="upload-section-unified">
                    <div class="upload-card-unified">
                        <div class="upload-card-header">
                            <h3>
                                Interview Transcripts
                                <button class="info-btn-inline" onclick="showHowItWorks('transcripts')" title="How it works">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                    </svg>
                                </button>
                            </h3>
                            <span class="required-badge">Required</span>
                        </div>
                        <p style="color: var(--text-light); margin-bottom: 1rem;">Upload PDF or DOC files containing interview transcripts</p>
                        <input type="file" id="transcript-files" accept=".pdf,.doc,.docx,.txt" multiple style="display: none;">
                        <button class="upload-button" onclick="document.getElementById('transcript-files').click()">
                            üìÑ Upload Transcript Files (Multiple)
                        </button>
                        <div id="transcript-status" class="upload-status"></div>
                        <div id="transcript-files-list" class="uploaded-files-list" style="margin-top: 1rem;"></div>
                    </div>

                    <!-- Study Evaluation -->
                    <div class="upload-card-unified evaluation-report-card">
                        <div class="upload-card-header">
                            <h3>
                                Study Evaluation
                                <button class="info-btn-inline" onclick="showHowItWorks('evaluation-report')" title="How it works">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                    </svg>
                                </button>
                            </h3>
                            <div class="header-right">
                                <div id="build-report-topics-list" class="topics-list-header">
                                    <!-- Topics will be listed here -->
                                </div>
                                <span class="required-badge">Required</span>
                            </div>
                        </div>
                        <p style="color: var(--text-light); margin-bottom: 1rem;">Upload PDF or DOC files containing participant transcripts or evaluation reports</p>
                        <input type="file" id="questions-file" accept=".pdf,.doc,.docx,.txt" multiple style="display: none;">
                        <button class="upload-button" onclick="document.getElementById('questions-file').click()">
                            üìÑ Upload Files (Multiple)
                        </button>
                        <div id="questions-status" class="upload-status"></div>
                        <div id="questions-files-list" class="uploaded-files-list" style="margin-top: 1rem;"></div>
                    </div>

                    <!-- AI Training Examples -->
                    <div class="upload-card-unified">
                        <div class="upload-card-header">
                            <h3>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 0.5rem;">
                                    <path d="M12 2a4 4 0 0 1 4 4v2a4 4 0 0 1-8 0V6a4 4 0 0 1 4-4z"></path>
                                    <path d="M16 14v6a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-6"></path>
                                    <circle cx="12" cy="14" r="4"></circle>
                                </svg>
                                AI Training Examples
                            </h3>
                            <span class="optional-badge">Optional</span>
                        </div>
                        <p style="color: var(--text-light); margin-bottom: 1rem;">Upload presentation examples to train AI on your preferred style</p>
                        <input type="file" id="presentation-files-input" accept=".xls,.xlsx,.doc,.docx,.pdf" multiple style="display: none;">
                        <button class="upload-button" onclick="document.getElementById('presentation-files-input').click()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            Upload Presentation Examples
                        </button>
                        <p style="color: var(--text-light); font-size: 0.875rem; margin-top: 0.5rem;">
                            Supported: Excel, Word, PDF
                        </p>
                        <div id="presentations-list-compact" class="video-list-compact" style="display: none; margin-top: 1rem;">
                            <h4 style="font-size: 0.95rem; margin: 0 0 0.5rem 0; color: var(--text);">Uploaded Examples (<span id="presentation-count-compact">0</span>)</h4>
                            <div id="presentation-items-compact" class="compact-items-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Master Analyze Button -->
                <div class="master-analyze-section">
                    <button id="analyze-btn" class="master-analyze-button">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        Analyze & Generate Report
                    </button>
                    <p style="color: var(--text-light); text-align: center; margin-top: 1rem; font-size: 0.95rem;">
                        This will process all uploaded data and generate comprehensive insights
                    </p>
                </div>

                <div class="transcripts-display"></div>
            </section>

            <!-- Hidden sections (kept for backward compatibility) -->
            <section id="upload-videos" class="section" style="display: none;">
                <h2>üé• Upload Videos</h2>
                <p style="color: var(--text-light); margin-bottom: 2rem; font-size: 1.125rem;">
                    Upload user testing session videos for behavioral analysis and synthesis. Each video can be labeled with participant information for organized insights.
                </p>

                <div class="video-upload-container">
                    <!-- Upload Control -->
                    <div class="upload-card">
                        <h3>üìπ Add Video Recording</h3>
                        <p style="color: var(--text-light); margin-bottom: 1rem;">Upload user testing session videos (MP4, WebM, MOV)</p>
                        <input type="file" id="video-file-input" accept="video/mp4,video/webm,video/quicktime,video/x-msvideo" style="display: none;">
                        <button class="upload-button" onclick="document.getElementById('video-file-input').click()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M23 7l-7 5 7 5V7z"></path>
                                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                            </svg>
                            Select Video File
                        </button>
                        <div id="video-upload-status" class="upload-status"></div>
                    </div>

                    <!-- Video List -->
                    <div class="uploaded-videos-section">
                        <h3>üìã Uploaded Videos (<span id="video-count">0</span>/12)</h3>
                        <div id="video-list" class="video-list">
                            <div class="empty-state">
                                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--text-light); margin-bottom: 1rem;">
                                    <path d="M23 7l-7 5 7 5V7z"></path>
                                    <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                                </svg>
                                <p style="color: var(--text-light);">No videos uploaded yet. Add your first video above.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Video Analysis Section -->
                    <div class="bot-instructions-section">
                        <h3>ü§ñ Analysis Instructions for AI</h3>
                        <p style="color: var(--text-light); margin-bottom: 1rem;">
                            Provide specific instructions on how you'd like the AI to analyze and synthesize these videos.
                        </p>
                        <textarea id="bot-instructions" class="bot-instructions-textarea" placeholder="Example instructions:

‚Ä¢ Focus on usability issues and confusion points
‚Ä¢ Track task completion rates and time on task
‚Ä¢ Note verbal feedback and emotional reactions
‚Ä¢ Identify common navigation patterns across users
‚Ä¢ Extract direct quotes from participant commentary
‚Ä¢ Highlight moments of delight or frustration
‚Ä¢ Compare behavior between different user segments
‚Ä¢ Synthesize findings into key themes and recommendations

Add your own custom instructions here..."></textarea>
                        
                        <button class="analyze-button" id="analyze-videos-btn" disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
                                <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                            Analyze Video & Generate Report
                        </button>
                        
                        <div id="analysis-progress" class="analysis-progress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill"></div>
                            </div>
                            <p id="progress-text">Processing videos...</p>
                        </div>
                    </div>

                    <!-- Teach AI Link -->
                    <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 2rem; border-radius: 12px; margin-top: 2rem; border-left: 4px solid var(--primary); text-align: center;">
                        <h4 style="color: var(--primary); margin-bottom: 0.75rem; font-size: 1.125rem;">üí° Want to improve AI-generated presentations?</h4>
                        <p style="color: var(--text); margin-bottom: 1.5rem; line-height: 1.7;">
                            Upload presentation examples to teach the AI your preferred styles, formatting, and visualization techniques.
                        </p>
                        <a href="#teach-ai" class="nav-link" style="display: inline-flex; align-items: center; gap: 0.5rem; background: var(--primary); color: white; padding: 0.875rem 2rem; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s ease;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                <path d="M2 17l10 5 10-5"></path>
                                <path d="M2 12l10 5 10-5"></path>
                            </svg>
                            Teach AI
                        </a>
                    </div>
                </div>
            </section>

            <section id="teach-ai" class="section" style="display: none;">
                <h2>ü§ñ Teach AI</h2>
                <p style="color: var(--text-light); margin-bottom: 2rem; font-size: 1.125rem;">
                    Train the AI to create better presentations by providing examples of effective presentation styles and formatting.
                </p>

                <div class="video-upload-container">
                    <!-- Presentation Upload Section -->
                    <div class="presentation-upload-section">
                        <h3>üìä Upload Presentation Examples</h3>
                        <p style="color: var(--text-light); margin-bottom: 1.5rem;">
                            Submit presentation examples to help the AI learn effective presentation styles and formatting.
                        </p>

                        <!-- Guidelines -->
                        <div class="guidelines-section">
                            <h4>üìã Upload Guidelines</h4>
                            <p style="color: var(--text-light); font-size: 0.95rem; line-height: 1.7; margin-bottom: 1rem;">
                                Good presentation examples should demonstrate:
                            </p>
                            <ul class="guidelines-list">
                                <li>Clear data visualization and charts</li>
                                <li>Well-organized information hierarchy</li>
                                <li>Consistent formatting and styling</li>
                                <li>Effective use of whitespace</li>
                                <li>Professional color schemes</li>
                                <li>Actionable insights and recommendations</li>
                            </ul>
                        </div>

                        <!-- Upload Interface -->
                        <div class="upload-presentations-card">
                            <input type="file" id="presentation-files-input" accept=".xls,.xlsx,.doc,.docx,.pdf" multiple style="display: none;">
                            <button class="upload-button" onclick="document.getElementById('presentation-files-input').click()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                Upload Presentation Example
                            </button>
                            <p style="color: var(--text-light); font-size: 0.875rem; margin-top: 0.5rem;">
                                Supported formats: Excel (.xls, .xlsx), Word (.doc, .docx), PDF (.pdf)
                            </p>
                        </div>

                        <!-- Uploaded Presentations List -->
                        <div id="presentations-list" class="presentations-list" style="display: none;">
                            <h4>üìÅ Uploaded Examples (<span id="presentation-count">0</span>)</h4>
                            <div id="presentation-items"></div>
                        </div>

                        <!-- Submit Section -->
                        <div class="submit-section" style="display: none;" id="submit-section">
                            <button class="submit-button" id="submit-presentations-btn">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                </svg>
                                Submit All Presentations
                            </button>
                            <div id="submission-feedback" class="submission-feedback"></div>
                        </div>

                        <!-- FAQ Section -->
                        <div class="faq-section">
                            <div class="faq-header" onclick="toggleFAQ()">
                                <h4>‚ùì Frequently Asked Questions</h4>
                                <span class="faq-toggle-icon">‚Ä∫</span>
                            </div>
                            <div class="faq-content">
                                <div class="faq-item">
                                    <strong>Q: What file formats are supported?</strong>
                                    <p>A: We support Excel (.xls, .xlsx), Word (.doc, .docx), and PDF (.pdf) files.</p>
                                </div>
                                <div class="faq-item">
                                    <strong>Q: How many files can I upload at once?</strong>
                                    <p>A: You can upload multiple files simultaneously. There's no strict limit, but we recommend uploading 3-5 high-quality examples.</p>
                                </div>
                                <div class="faq-item">
                                    <strong>Q: What makes a good presentation example?</strong>
                                    <p>A: Good examples have clear data visualization, consistent formatting, professional styling, and actionable insights.</p>
                                </div>
                                <div class="faq-item">
                                    <strong>Q: Can I edit the title or description after uploading?</strong>
                                    <p>A: Yes, you can edit the title and description at any time before submitting.</p>
                                </div>
                                <div class="faq-item">
                                    <strong>Q: What happens after I submit?</strong>
                                    <p>A: The AI will analyze your examples to learn effective presentation patterns, styles, and formatting techniques.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="select-study" class="section active">
                <h2>Select Study</h2>
                <p style="color: var(--text-light); margin-bottom: 2rem; font-size: 1.125rem;">
                    Choose a study to view its research findings and insights.
                </p>
                
                <div class="studies-grid" id="studies-list">
                    <!-- Studies will be rendered here dynamically -->
                </div>
            </section>

            <section id="uxd-admin" class="section">
                <h2>‚öôÔ∏è UXD Admin</h2>
                <p style="color: var(--text-light); margin-bottom: 2rem; font-size: 1.125rem;">
                    Manage your research campaigns and switch between different projects.
                </p>

                <div class="admin-container">
                    <!-- Current Study -->
                    <div class="current-campaign-section">
                        <h3>Current Study</h3>
                        <div class="current-campaign-card-wrapper">
                            <div class="current-campaign-card-header">
                                <div class="campaign-info">
                                    <div class="campaign-title-row">
                                        <h4 id="current-campaign-title">ISS Iterative Testing 4.1</h4>
                                        <button class="edit-title-btn" onclick="editCampaignTitle()" title="Edit study name">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <p>Active Study</p>
                                </div>
                                <div class="campaign-header-actions">
                                    <a href="#transcripts" class="nav-link edit-campaign-btn">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                        </svg>
                                        Edit Study Report
                                    </a>
                                    <a href="#executive-summary" class="nav-link view-dashboard-btn">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                            <polyline points="14 2 14 8 20 8"></polyline>
                                            <line x1="16" y1="13" x2="8" y2="13"></line>
                                            <line x1="16" y1="17" x2="8" y2="17"></line>
                                            <polyline points="10 9 9 9 8 9"></polyline>
                                        </svg>
                                        View Report
                                    </a>
                                </div>
                            </div>
                            
                            <!-- Current Study Files Display (inside card) -->
                            <div id="current-campaign-files" class="current-campaign-files-inside">
                                <!-- Files will be rendered here -->
                            </div>
                        </div>
                    </div>

                    <!-- All Studies List -->
                    <div class="campaigns-section">
                        <div class="campaigns-header">
                            <h3>üìÅ All Studies</h3>
                            <button class="create-campaign-btn" onclick="openCreateCampaignModal()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                New Study
                            </button>
                        </div>
                        
                        <div id="campaigns-list" class="campaigns-list">
                            <!-- Studies will be rendered here -->
                        </div>
                    </div>
                    
                    <!-- AI Settings -->
                    <div class="ai-settings-section">
                        <h3>ü§ñ AI Analysis Settings</h3>
                        <p style="color: var(--text-light); margin-bottom: 1rem; font-size: 0.95rem;">
                            Configure your Claude API key to enable AI-powered report analysis.
                        </p>
                        
                        <div class="ai-settings-card">
                            <div class="ai-status">
                                <div class="ai-status-indicator">
                                    <div id="ai-status-dot" class="status-dot status-inactive"></div>
                                    <span id="ai-status-text">AI Not Configured</span>
                                </div>
                                <div id="ai-key-display" class="ai-key-masked">No API key set</div>
                            </div>
                            
                            <div class="ai-config-form">
                                <label for="ai-api-key-input">
                                    <strong>Claude API Key</strong>
                                    <a href="https://console.anthropic.com" target="_blank" style="color: var(--primary); font-size: 0.875rem; margin-left: 0.5rem;">
                                        Get API Key ‚Üí
                                    </a>
                                </label>
                                <input 
                                    type="password" 
                                    id="ai-api-key-input" 
                                    placeholder="sk-ant-api03-..."
                                    style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 6px; margin-top: 0.5rem; font-family: monospace;"
                                >
                                <div style="display: flex; gap: 0.75rem; margin-top: 1rem;">
                                    <button class="save-api-key-btn" onclick="saveAPIKey()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                            <polyline points="7 3 7 8 15 8"></polyline>
                                        </svg>
                                        Save API Key
                                    </button>
                                    <button class="test-api-key-btn" onclick="testAPIKey()" style="background: var(--border); color: var(--text);">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                                        </svg>
                                        Test Connection
                                    </button>
                                </div>
                            </div>
                            
                            <div class="ai-info">
                                <p style="font-size: 0.875rem; color: var(--text-light); margin: 0;">
                                    üí° <strong>Cost:</strong> ~$0.20 per study analysis with Claude 3.5 Sonnet
                                </p>
                                <p style="font-size: 0.875rem; color: var(--text-light); margin: 0.5rem 0 0 0;">
                                    üîí Your API key is stored securely in your browser and never sent to GitHub.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Create/Edit Study Modal -->
    <div id="campaign-modal" class="campaign-modal" style="display: none;">
        <div class="campaign-modal-content">
            <h3 id="campaign-modal-title">Create New Study</h3>
            <input type="text" id="campaign-name-input" placeholder="Enter study name" class="campaign-input">
            <div class="campaign-modal-actions">
                <button class="cancel-btn" onclick="closeCampaignModal()">Cancel</button>
                <button class="save-campaign-btn" onclick="saveCampaign()">Create Study</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="delete-modal" style="display: none;">
        <div class="delete-modal-content">
            <div class="delete-icon">‚ö†Ô∏è</div>
            <h3>Delete Study?</h3>
            <p id="delete-campaign-name" style="margin: 1rem 0; color: var(--text);"></p>
            <p style="color: var(--danger); font-weight: 600; margin-bottom: 1.5rem;">
                All campaign data will be permanently erased. This action cannot be undone.
            </p>
            <div class="delete-modal-actions">
                <button class="cancel-btn" onclick="closeDeleteModal()">Cancel</button>
                <button class="delete-confirm-btn" onclick="confirmDeleteCampaign()">Delete Study</button>
            </div>
        </div>
    </div>

    <!-- PDF.js Library for PDF parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <!-- Success Notification -->
    <div id="success-notification" class="success-notification" style="display: none;">
        <div class="success-notification-content">
            <div class="success-notification-header">
                <div class="success-notification-icon">‚úì</div>
                <h3>Thank you!</h3>
            </div>
            <div class="success-notification-message" id="notification-message"></div>
        </div>
    </div>

    <!-- Chart.js for vector charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.js"></script>
    
    <!-- html2pdf for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- Supabase for real-time collaboration -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Collaboration scripts (cache-busted) -->
    <script src="supabase-config.js?v=20260201b"></script>
    <script src="collaboration-manager.js?v=20260201b"></script>
    
    <!-- PDF.js library for parsing PDFs (local files) -->
    <script src="lib/pdf.min.js"></script>
    <script>
        // Set PDF.js worker
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'lib/pdf.worker.min.js';
            console.log('PDF.js loaded successfully');
        } else {
            console.error('PDF.js failed to load');
        }
    </script>
    
    <!-- Custom UI components -->
    <script src="custom-confirm.js?v=20260201b"></script>
    
    <!-- AI Analysis -->
    <script src="ai-config.js"></script>
    <script src="ai-analyzer.js"></script>
    
    <script src="synthesis-data.js?v=20260201b"></script>
    <script src="script.js?v=1706857400"></script>
    <script src="file-upload.js?v=20260201b"></script>
    <script src="presentation.js?v=20260201b"></script>
    <script src="presentation-builder.js?v=20260201b"></script>
    <script src="ai-chat-assistant.js?v=20260201b"></script>
    <script>
        // ONE-TIME DATA CLEAR - Remove this block after data is cleared
        (function() {
            const clearFlag = localStorage.getItem('data_cleared_20260201');
            if (!clearFlag) {
                console.log('Clearing corrupted test data...');
                // Clear campaign reportNotes
                try {
                    const stored = localStorage.getItem('uxd_campaigns');
                    if (stored) {
                        const campaigns = JSON.parse(stored);
                        campaigns.forEach(c => { c.reportNotes = []; });
                        localStorage.setItem('uxd_campaigns', JSON.stringify(campaigns));
                    }
                    localStorage.removeItem('note_boards');
                    localStorage.removeItem('current_board_id');
                    localStorage.removeItem('customTopics');
                    localStorage.setItem('data_cleared_20260201', 'true');
                    console.log('Data cleared successfully!');
                } catch(e) { console.error('Clear failed:', e); }
            }
        })();
        
        // Debug: Log everything for troubleshooting
        console.log('=== PAGE INIT START ===');
        
        // Set default page to Select Study if no hash is present
        if (!window.location.hash) {
            window.location.hash = 'select-study';
        }
        
        // Handle navigation based on hash on page load
        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded fired');
            const hash = window.location.hash.substring(1) || 'select-study';
            console.log('Target section:', hash);
            
            if (typeof navigateToSection === 'function') {
                console.log('navigateToSection exists, calling it');
                navigateToSection(hash);
            } else {
                console.error('navigateToSection function not found!');
            }
        });
        
        // Force load data after page is ready
        window.addEventListener('load', function() {
            console.log('=== PAGE LOAD COMPLETE ===');
            console.log('synthesisData exists?', typeof synthesisData !== 'undefined');
            console.log('loadSampleData exists?', typeof loadSampleData !== 'undefined');
            console.log('renderInsights exists?', typeof renderInsights !== 'undefined');
            
            if (typeof synthesisData !== 'undefined' && synthesisData) {
                console.log('synthesisData has', Object.keys(synthesisData).length, 'keys');
                
                if (typeof loadSampleData === 'function') {
                    console.log('Calling loadSampleData...');
                    try {
                        loadSampleData();
                        console.log('loadSampleData completed');
                    } catch (error) {
                        console.error('Error in loadSampleData:', error);
                    }
                } else {
                    console.error('loadSampleData function not found!');
                }
            } else {
                console.error('synthesisData not found - check if synthesis-data.js loaded');
            }
        });
        
        // Global error handler
        window.onerror = function(msg, url, line, col, error) {
            console.error('Global error:', msg, 'at', url, 'line', line);
            return false;
        };
    </script>
</body>
</html>
